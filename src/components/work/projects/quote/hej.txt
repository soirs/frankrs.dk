// Quote.js

import React, { Fragment } from "react";
import "./Quote.css";


class Quote extends React.Component {
    state = {
        url: "https://quotesondesign.com/wp-json/posts?filter[orderby]=rand&filter[posts_per_page]=1",
        // quote: [],
        quote: {
            id: '',
            content: '',
            title: '',
            link: ''
        },
        hasQuote: false
    };

        componentWillMount() {
        fetch(this.state.url)
          .then(response => {
            let content = response.data;
            let title = response.data;
            this.setState({'title': title, 'content': content, hasQuote: true});
            })
        //   .then(data => this.setState({'title': data[0].title, 'content': data[0].content, hasQuote: true}))
          .catch(error => console.log("Error: " + error));
    }

    // componentDidMount() {
    //     fetch(this.state.url)
    //       .then(response => response.json())
    //       .then(data => this.storeQuote(data))
    //       .catch(error => console.log("Whoops " + error));
    // }

    getRandomQuote = event => {
        fetch(this.state.url)
          .then(response => response.json())
          .then(data => {
              let { quote } = this.state;
              let quoteData = data[0];
              quote.content = quoteData.content;
              quote.link = quoteData.link;
              quote.title = quoteData.title;
              this.setState({ quote }, () => {
                  if(this.state.hasQuote === false) {
                      this.setState({ hasQuote: true })
                  }
              })
          })
          .catch(error => console.log(error));
    }

    storeQuote = data => {
        const quote = data.map( result => {
            const { ID, title, content, link } = result[0];
            return { ID, title, content, link };
        });
        this.setState({quote});
        console.log({quote});
    }

    renderQuote = () => {
        const { content, link, title  } = this.state.quote;
        
        return (
            {title}
        )
    }

    render() {
        console.log(this.state.quote);
        const { hasQuote } = this.state;
        return(
            <section className="quote">
            <div className="wikiHead">
                <h2>Quotes on Design</h2>
                <Fragment>
                {hasQuote === true ? this.renderQuote() : 'Click mayn'}
                <button className="generate" onClick={this.getRandomQuote}>New Quote</button>                
                </Fragment>
                <p>BREAK</p>
            </div>

            </section>
        )
    }
}

export default Quote;